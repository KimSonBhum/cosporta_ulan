<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kelola Produk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4">Kelola Produk</h2>

    <div id="notification" class="alert d-none"></div>

    <!-- Form tambah produk -->
    <form id="productForm" class="row g-3 mb-4">
        <div class="col-md-5">
            <input type="text" id="name" class="form-control" placeholder="Nama Produk" required>
        </div>
        <div class="col-md-4">
            <input type="number" id="price" class="form-control" placeholder="Harga Produk" required>
        </div>
        <div class="col-md-3 d-grid">
            <button type="submit" class="btn btn-primary">Tambah Produk</button>
        </div>
    </form>

    <h3 class="mb-3">Daftar Produk</h3>
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Nama</th>
            <th>Harga</th>
            <th>Aksi</th>
        </tr>
        </thead>
        <tbody id="productTableBody"></tbody>
    </table>

    <!-- Pagination -->
    <nav>
        <ul id="pagination" class="pagination justify-content-center"></ul>
    </nav>

    <a href="menu.html" class="btn btn-secondary mt-3">⬅ Kembali ke Menu</a>
</div>

<script>
    const baseUrl = "http://localhost:8080/Produk";
    let allProducts = [];
    let currentPage = 1;
    const rowsPerPage = 10;

    function showNotification(message, type) {
      const notif = document.getElementById("notification");
      notif.textContent = message;
      notif.className = "alert alert-" + type;
      notif.classList.remove("d-none");
      setTimeout(() => notif.classList.add("d-none"), 2000);
    }

    async function loadProducts() {
      const res = await fetch(baseUrl);
      allProducts = await res.json();
      renderTable();
      renderPagination();
    }

    function renderTable() {
      const tbody = document.getElementById("productTableBody");
      tbody.innerHTML = "";

      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageProducts = allProducts.slice(start, end);

      pageProducts.forEach(p => {
        const row = `<tr>
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.price.toLocaleString("id-ID")}</td>
          <td>
            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})">Hapus</button>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function renderPagination() {
      const totalPages = Math.ceil(allProducts.length / rowsPerPage);
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";

      // Prev button
      const prevLi = document.createElement("li");
      prevLi.className = "page-item" + (currentPage === 1 ? " disabled" : "");
      prevLi.innerHTML = `<a class="page-link" href="#">Prev</a>`;
      prevLi.addEventListener("click", (e) => {
        e.preventDefault();
        if (currentPage > 1) {
          currentPage--;
          renderTable();
          renderPagination();
        }
      });
      pagination.appendChild(prevLi);

      // Number buttons
      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement("li");
        li.className = "page-item" + (i === currentPage ? " active" : "");
        li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        li.addEventListener("click", (e) => {
          e.preventDefault();
          currentPage = i;
          renderTable();
          renderPagination();
        });
        pagination.appendChild(li);
      }

      // Next button
      const nextLi = document.createElement("li");
      nextLi.className = "page-item" + (currentPage === totalPages ? " disabled" : "");
      nextLi.innerHTML = `<a class="page-link" href="#">Next</a>`;
      nextLi.addEventListener("click", (e) => {
        e.preventDefault();
        if (currentPage < totalPages) {
          currentPage++;
          renderTable();
          renderPagination();
        }
      });
      pagination.appendChild(nextLi);
    }

    document.getElementById("productForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const price = document.getElementById("price").value;

      await fetch(baseUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, price })
      });

      document.getElementById("productForm").reset();
      loadProducts();
      showNotification("✅ Produk berhasil ditambahkan!", "success");
    });

    async function deleteProduct(id) {
      await fetch(`${baseUrl}/${id}`, { method: "DELETE" });
      loadProducts();
      showNotification("❌ Produk berhasil dihapus!", "danger");
    }

    loadProducts();
</script>
</body>
</html>
